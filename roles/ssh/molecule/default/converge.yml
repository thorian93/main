---
- name: Converge
  hosts: all

  pre_tasks:

    - name: "Update APT Cache."
      ansible.builtin.apt:
        update_cache: true
        cache_valid_time: 600
      when: ansible_facts['os_family'] == 'Debian'

    - name: "Ensure SSHD is installed."
      ansible.builtin.package:
        name: openssh-server
        state: present

    - name: "Ensure SSHD is running on Debian Derivates."
      when: ansible_facts['os_family'] == "Debian"
      ansible.builtin.service:
        name: ssh
        state: started

    - name: "Ensure SSHD is running on RedHat Derivates."
      when: ansible_facts['os_family'] == "RedHat"
      ansible.builtin.service:
        name: sshd
        state: started

  tasks:

    - name: "Run role."
      ansible.builtin.include_role:
        name: ssh
